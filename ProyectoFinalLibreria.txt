
//Buscar

using System;
using System.Drawing;
using System.Windows.Forms;

namespace Libreria
       {
	
	public partial class Buscar : Form
	{
		public Buscar()
		     {
			InitializeComponent();
		                }
		
		public Libros libroSeleccionado {get; set;}
		
		
		
		void BtnBuscarClick(object sender, EventArgs e)
		         {
			dvgTodos.DataSource=Metodos.Buscar(txtBus.Text);
		}
		
		void BtnAceptarClick(object sender, EventArgs e)
		{
			if (dvgTodos.SelectedRows.Count==1)
			
			{
				int id=Convert.ToInt32(dvgTodos.CurrentRow.Cells[0].Value);
				libroSeleccionado=Metodos.ObtenerLibros(id);
				this.Close();
			}
			else MessageBox.Show("DEBES SELECCIONAR UNA FILA");	
		}
		
		
		
		
		
		void BtnCancelarClick(object sender, EventArgs e)
		{
			MainForm abrir = new MainForm();
			abrir.Show();
			this.Hide();			
		}
	}
}


//Program

using System;
using System.Windows.Forms;

namespace Libreria
          {
	
	internal sealed class Program
	{
		
		[STAThread]
		private static void Main(string[] args)
		{
			Application.EnableVisualStyles();
			Application.SetCompatibleTextRenderingDefault(false);
			Application.Run(new MainForm());
		    }
		
	    }
}


//Metodos

using System;
using MySql.Data.MySqlClient;
using System.Collections.Generic;

namespace Libreria
{
	
	public class Metodos
	{
		
		public static int Agregar(Libros pLibros)
		{
			int retorno =0;
			
			MySqlCommand comando =new MySqlCommand(string.Format("insert into libros(nombre, autor, editorial, anio)values ('{0}','{1}','{2}','{3}')",
			                                                     pLibros.libro, pLibros.autor, pLibros.editorial, pLibros.anio),Conectar.ObtenerConexion());
			retorno = comando.ExecuteNonQuery();
			return retorno;
		}
		
		public static List<Libros> Buscar(string plibro)
		{
			List<Libros> _lista = new List<Libros>();
			MySqlCommand _comando = new MySqlCommand(string.Format("select id, nombre, autor, editorial, anio from libros where nombre LIKE '%{0}%'",plibro),Conectar.ObtenerConexion());
			MySqlDataReader _reader=_comando.ExecuteReader();
			while (_reader.Read())
			{
				Libros pLibros = new Libros();
				
				pLibros.id=_reader.GetInt32(0);
				pLibros.libro=_reader.GetString(1);
				pLibros.autor=_reader.GetString(2);
				pLibros.editorial=_reader.GetString(3);
				pLibros.anio=_reader.GetString(4);
				
				_lista.Add(pLibros);
								
			}
			return _lista;
			
		}
		
		public static Libros ObtenerLibros(int pId)
		{
			Libros pLibros = new Libros();
			MySqlConnection conexion = Conectar.ObtenerConexion();
			MySqlCommand _comando = new MySqlCommand(string.Format("select id, nombre, autor, editorial, anio from libros where id = '{0}'",pId),Conectar.ObtenerConexion());
			MySqlDataReader _reader =_comando.ExecuteReader();
			while(_reader.Read())
			{
				pLibros.id=_reader.GetInt32(0);
				pLibros.libro=_reader.GetString(1);
				pLibros.autor=_reader.GetString(2);
				pLibros.editorial=_reader.GetString(3);
				pLibros.anio=_reader.GetString(4);
			}
			conexion.Close();
			return pLibros;
		}
		
		
		public static int Editar(Libros pLibros)
		{
			int retorno=0;
			
			MySqlConnection conexion=Conectar.ObtenerConexion();
			MySqlCommand comando = new MySqlCommand(string.Format("update libros set nombre = '{0}', autor ='{1}', editorial= '{2}', anio ='{3}' where id = '{4}'",pLibros.libro, pLibros.autor, pLibros.editorial, pLibros.anio, pLibros.id), conexion);
			retorno = comando.ExecuteNonQuery();
			conexion.Close();
			return retorno;
					
		}
		
		public static int Eliminar(int pId)
		{
			int retorno =0;
			MySqlConnection conexion = Conectar.ObtenerConexion();
			MySqlCommand comando = new MySqlCommand(string.Format("delete from libros where id={0}", pId),conexion);
			retorno = comando.ExecuteNonQuery();
			return retorno;
		}
		
		
	}
}
